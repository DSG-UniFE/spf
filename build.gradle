/*
 * This build file was auto generated by running the Gradle 'init' task
 * by 'marco' at '27/06/16 11:00' with Gradle 2.14
 */

// Apply the required plugins
apply plugin: 'eclipse'
apply plugin: 'java'
apply plugin: "com.github.jruby-gradle.base"
apply plugin: "com.github.jruby-gradle.jar"


buildscript {
    repositories { 
        jcenter()
    }
    
    dependencies {
        classpath 'com.github.jruby-gradle:jruby-gradle-plugin:1.3.0'
        classpath 'com.github.jruby-gradle:jruby-gradle-jar-plugin:1.3.0'
        //classpath 'net.sourceforge.tess4j:tess4j:3.2.0'
    }
}
    
// In this section you declare where to find the dependencies of your project
repositories {
    // Use 'jcenter' for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
}

// In this section you declare the dependencies for your production and test code
dependencies {
    // The production code uses the SLF4J logging API at compile time
    //compile 'org.slf4j:slf4j-api:1.7.21'
	//compile group: 'com.github.jai-imageio', name: 'jai-imageio-core', version: '1.3.0'
    // Declare the dependency for your favourite test framework you want to use in your tests.
    // TestNG is also supported by the Gradle Test task. Just change the
    // testCompile dependency to testCompile 'org.testng:testng:6.8.1' and add
    // 'test.useTestNG()' to your build script.
    //testCompile 'junit:junit:4.12'
    compile fileTree(dir: 'libs', include: '*.jar')
    jrubyJar "rubygems:concurrent-ruby:1.0.2"
    jrubyJar "rubygems:rest-client:2.0.0"
}

 
jrubyJar{
	
	from ("${projectDir}") {           // ADD RUBY PROJECT DIRECTORY
      include 'src/**/*.*'
    }
    println "Added src/main/java and src/main/ruby"
    
    from ('resources/') {
        include('**/*.*')
    }
    println "Added resources"
    
        
	from {                    // ADD JAVA LIBRARIES TO FINAL JAR
        (configurations.compile).collect {
            it.isDirectory() ? it : zipTree(it)
        }
    }
 
    from sourceSets.main.output
    initScript "${projectDir}/Entrypoint-gateway.rb"
    println "Defined Entrypoint for gateway JAR.\n"
}



task runGradleTest(type: Exec) {

    dependsOn jrubyJar
    description "Execute the constructed self-executing jar"
    environment [:]
    println "Putting executable jars into bin/ ...."
    workingDir "${buildDir}/libs"  // Change this with the new 'bin' folder: {projectDir/bin}
    println "\n\n END: Jars complete\n\n"
    //commandLine 'java', '-jar', jrubyJar.outputs.files.singleFile.absolutePath
}